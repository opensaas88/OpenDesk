{{/*
SPDX-FileCopyrightText: 2023 Bundesministerium des Innern und für Heimat, PG ZenDiS "Projektgruppe für Aufbau ZenDiS"
SPDX-License-Identifier: Apache-2.0
*/}}
---
image:
  registry: "{{ .Values.global.imageRegistry }}"
  url: "{{ .Values.images.dovecot.repository }}"
  tag: "{{ .Values.images.dovecot.tag }}"

imagePullSecrets:
{{- range .Values.global.imagePullSecrets }}
  - name: {{ . }}
{{- end }}

dovecot:
  mailDomain: "{{ .Values.global.domain }}"
  password: {{ .Values.secrets.dovecot.doveadm }}
  ldap:
    dn: "uid=ldapsearch_dovecot,cn=users,dc=swp-ldap,dc=internal"
    password: {{ .Values.secrets.univentionCorporateServer.ldapSearch.dovecot }}
  oidc:
    introspectionURL: "https://{{ .Values.global.hosts.keycloak }}.{{ .Values.global.domain }}/realms/souvap/protocol/openid-connect/token/introspect"
    clientSecret: {{ .Values.secrets.keycloak.clientSecret.as8oidc }}
    clientID: "as8oidc"
  loginTrustedNetworks: "{{ .Values.cluster.networking.cidr }}"

ingress:
  tls:
    secretName: "{{ .Values.ingress.tls.secretName }}"

{{- if .Values.cluster.persistence.readWriteMany.enabled }}
replicaCount: {{ .Values.replicas.dovecot }}
{{- else }}
replicaCount: 1
{{- end }}


persistence:
  {{- if .Values.cluster.persistence.readWriteMany.enabled }}
  storageClassName: "{{ .Values.persistence.storageClassNames.RWX }}"
  accessModes:
    - "ReadWriteMany"
  {{- else }}
  storageClassName: "{{ .Values.persistence.storageClassNames.RWO }}"
  accessModes:
    - "ReadWriteOnce"
  {{- end }}
  size: "{{ .Values.persistence.size.dovecot }}"

resources:
  {{ .Values.resources.dovecot | toYaml | nindent 2 }}
...
